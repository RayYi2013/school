var ngMap=ngMap||{};ngMap.directives=ngMap.directives||{},ngMap.directives.infoWindow={deps:["Attr2Options"]},ngMap.directives.infoWindow.func=function(Attr2Options){var parser=Attr2Options;return{restrict:"E",require:"^map",link:function(scope,element,attrs,mapController){var filtered=parser.filter(attrs);scope.google=google;var options=parser.getOptions(filtered,scope);options.pixelOffset&&(options.pixelOffset=google.maps.Size.apply(this,options.pixelOffset));var infoWindow=new google.maps.InfoWindow(options);infoWindow.contents=element.html();var events=parser.getEvents(scope,filtered);for(var eventName in events)eventName&&google.maps.event.addListener(infoWindow,eventName,events[eventName]);mapController.infoWindows.push(infoWindow),element.css({display:"none"}),scope.showInfoWindow=function(event,id,options){var infoWindow=scope.infoWindows[id],contents=infoWindow.contents,matches=contents.match(/\[\[[^\]]+\]\]/g);if(matches)for(var i=0,length=matches.length;length>i;i++){var expression=matches[i].replace(/\[\[/,"").replace(/\]\]/,"");try{contents=contents.replace(matches[i],eval(expression))}catch(e){expression="options."+expression,contents=contents.replace(matches[i],eval(expression))}}infoWindow.setContent(contents),infoWindow.open(scope.map,this)}}}};var ngMap=ngMap||{};ngMap.directives=ngMap.directives||{},ngMap.directives.map={deps:["Attr2Options","$parse","NavigatorGeolocation","GeoCoder","$compile"]},ngMap.directives.map.func=function(e,n,t,r){var o=e;return{restrict:"AE",controller:["$scope",function(e){this.map=null,this.controls={},this.markers=[],this.shapes=[],this.infoWindows=[],this.markerCluster=null,this.initMap=function(e,n,a){var i=o.filter(a);e.google=google;var s=o.getOptions(i,e),p=o.getControlOptions(i);for(var c in p)c&&(s[c]=p[c]);var l=this,g=null;if(s.zoom||(s.zoom=15),s.center instanceof Array){var v=s.center[0],u=s.center[1];s.center=new google.maps.LatLng(v,u)}else g=s.center,delete s.center;for(var f in this.controls)f&&(s[f+"Control"]="false"===this.controls[f].enabled?0:1,delete this.controls[f].enabled,s[f+"ControlOptions"]=this.controls[f]);var d=document.createElement("div");d.style.width="100%",d.style.height="100%",n.prepend(d),l.map=new google.maps.Map(d,s),"string"==typeof g?r.geocode({address:g}).then(function(e){l.map.setCenter(e[0].geometry.location)}):s.center||t.getCurrentPosition().then(function(e){var n=e.coords.latitude,t=e.coords.longitude;l.map.setCenter(new google.maps.LatLng(n,t))});var m=o.getEvents(e,i);for(var h in m)h&&google.maps.event.addListener(l.map,h,m[h]);return e.map=l.map,l.map},this.addMarker=function(n){n.setMap(this.map),n.centered&&this.map.setCenter(n.position);var t=Object.keys(e.markers).length;e.markers[n.id||t]=n},this.initMarkers=function(){e.markers={};for(var n=0;n<this.markers.length;n++){var t=this.markers[n];this.addMarker(t)}return e.markers},this.initShapes=function(){e.shapes={};for(var n=0;n<this.shapes.length;n++){var t=this.shapes[n];t.setMap(this.map),e.shapes[t.id||n+1]=t}return e.shapes},this.initInfoWindows=function(){e.infoWindows={};for(var n=0;n<this.infoWindows.length;n++){var t=this.infoWindows[n];e.infoWindows[t.id||n+1]=t}return e.infoWindows},this.initMarkerClusterer=function(){return this.markerClusterer&&(e.markerClusterer=new MarkerClusterer(this.map,this.markerClusterer.data,this.markerClusterer.pptions)),e.markerClusterer}}],link:function(e,n,t,r){var o=r.initMap(e,n,t);e.$emit("mapInitialized",o);var a=r.initMarkers();e.$emit("markersInitialized",a);var i=r.initShapes();e.$emit("shapesInitialized",i);var s=r.initInfoWindows();e.$emit("infoWindowsInitialized",s);var p=r.initMarkerClusterer();e.$emit("markerClustererInitialized",p)}}};var ngMap=ngMap||{};ngMap.directives=ngMap.directives||{},ngMap.directives.marker={deps:["Attr2Options","GeoCoder","NavigatorGeolocation"]},ngMap.directives.marker.func=function(e,n,t){var r=e;return{restrict:"E",require:"^map",link:function(e,o,a,i){var s=r.filter(a);e.google=google;var p=r.getOptions(s,e),c=r.getEvents(e,s),l=function(){var e=new google.maps.Marker(p);Object.keys(c).length>0;for(var n in c)n&&google.maps.event.addListener(e,n,c[n]);return e};if(p.position instanceof Array){var g=p.position[0],v=p.position[1];p.position=new google.maps.LatLng(g,v);var u=l();p.ngRepeat?i.addMarker(u):i.markers.push(u)}else if("string"==typeof p.position){var f=p.position;f.match(/^current/i)?t.getCurrentPosition().then(function(e){var n=e.coords.latitude,t=e.coords.longitude;p.position=new google.maps.LatLng(n,t);var r=l();i.addMarker(r)}):n.geocode({address:p.position}).then(function(e){var n=e[0].geometry.location;p.position=n;var t=l();i.addMarker(t)})}}}};var ngMap=ngMap||{};ngMap.directives=ngMap.directives||{},ngMap.directives.markerClusterer={deps:["Attr2Options"]},ngMap.directives.markerClusterer.func=function(e){var n=e;return{restrict:"E",require:"^map",link:function(e,t,r,o){var a=e.$eval(r.markers);delete r.markers;for(var i=n.filter(r),s=[],p=0;p<a.length;p++){var c=a[p],l=c.position[0],g=c.position[1];c.position=new google.maps.LatLng(l,g);var v=new google.maps.Marker(c),u=n.getEvents(e,c);for(var f in u)f&&google.maps.event.addListener(v,f,u[f]);s.push(v)}o.markers=s,o.markerClusterer={data:s,options:i}}}};var ngMap=ngMap||{};ngMap.directives=ngMap.directives||{},ngMap.directives.shape={deps:["Attr2Options"]},ngMap.directives.shape.func=function(e){var n=e,t=function(e){return e[0]&&e[0]instanceof Array?e.map(function(e){return new google.maps.LatLng(e[0],e[1])}):new google.maps.LatLng(e[0],e[1])},r=function(e){var n=t(e);return new google.maps.LatLngBounds(n[0],n[1])},o=function(e,n){switch(e){case"circle":return n.center=t(n.center),new google.maps.Circle(n);case"polygon":return n.paths=t(n.paths),new google.maps.Polygon(n);case"polyline":return n.path=t(n.path),new google.maps.Polyline(n);case"rectangle":return n.bounds=r(n.bounds),new google.maps.Rectangle(n);case"groundOverlay":case"image":var o=n.url,a=r(n.bounds),i={opacity:n.opacity,clickable:n.clickable};return new google.maps.GroundOverlay(o,a,i)}return null};return{restrict:"E",require:"^map",link:function(e,t,r,a){var i=n.filter(r),s=i.name;delete i.name;var p=n.getOptions(i),c=o(s,p);c&&a.shapes.push(c);var l=n.getEvents(e,i);for(var g in l)l[g]&&google.maps.event.addListener(c,g,l[g])}}};var ngMap=ngMap||{};ngMap.services=ngMap.services||{},ngMap.services.Attr2Options={deps:[]},ngMap.services.Attr2Options.func=function(){return{filter:function(e){var n={};for(var t in e)t.match(/^\$/)||(n[t]=e[t]);return n},getOptions:function(attrs,scope){var options={};for(var key in attrs)if(attrs[key]){if(key.match(/^on[A-Z]/))continue;if(key.match(/ControlOptions$/))continue;var val=attrs[key];try{var num=Number(val);if(isNaN(num))throw"Not a number";options[key]=num}catch(err){try{options[key]=JSON.parse(val)}catch(err2){if(val.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+val;options[key]=eval(exp)}catch(e){options[key]=val}else if(val.match(/^[A-Z][a-zA-Z0-9]+\.[A-Z]+$/))try{options[key]=scope.$eval("google.maps."+val)}catch(e){options[key]=val}else if(val.match(/^[A-Z]+$/))try{var capitializedKey=key.charAt(0).toUpperCase()+key.slice(1);options[key]=scope.$eval("google.maps."+capitializedKey+"."+val)}catch(e){options[key]=val}else options[key]=val}}}return options},getEvents:function(e,n){var t={},r=function(e){return"_"+e.toLowerCase()},o=function(n){var t=n.match(/([^\(]+)\(([^\)]*)\)/),r=t[1],o=t[2].replace(/event[ ,]*/,""),a=e.$eval("["+o+"]");return function(n){e[r].apply(this,[n].concat(a))}};for(var a in n)if(n[a]){if(!a.match(/^on[A-Z]/))continue;var i=a.replace(/^on/,"");i=i.charAt(0).toLowerCase()+i.slice(1),i=i.replace(/([A-Z])/g,r);var s=n[a];t[i]=new o(s)}return t},getControlOptions:function(e){var n={};for(var t in e)if(e[t]){if(!t.match(/(.*)ControlOptions$/))continue;var r=e[t],o=r.replace(/'/g,'"');o=o.replace(/([^"]+)|("[^"]+")/g,function(e,n,t){return n?n.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):t});try{var a=JSON.parse(o);for(var i in a)if(a[i]){var s=a[i];if("string"==typeof s?s=s.toUpperCase():"mapTypeIds"===i&&(s=s.map(function(e){return google.maps.MapTypeId[e.toUpperCase()]})),"style"===i){var p=t.charAt(0).toUpperCase()+t.slice(1),c=p.replace(/Options$/,"")+"Style";a[i]=google.maps[c][s]}else a[i]="position"===i?google.maps.ControlPosition[s]:s}n[t]=a}catch(l){}}return n}}};var ngMap=ngMap||{};ngMap.services=ngMap.services||{},ngMap.services.GeoCoder={deps:["$q"],func:function(e){return{geocode:function(n){var t=e.defer(),r=new google.maps.Geocoder;return r.geocode(n,function(e,n){n==google.maps.GeocoderStatus.OK?t.resolve(e):t.reject("Geocoder failed due to: "+n)}),t.promise}}}};var ngMap=ngMap||{};ngMap.services=ngMap.services||{},ngMap.services.NavigatorGeolocation={deps:["$q"],func:function(e){return{getCurrentPosition:function(){var n=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){n.resolve(e)},function(e){n.reject(e)}):n.reject("Browser Geolocation service failed."),n.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}}};var ngMap=ngMap||{};ngMap.services=ngMap.services||{},ngMap.services.StreetView={deps:["$q"],func:function(e){return{getPanorama:function(n,t){t=t||n.getCenter();var r=e.defer(),o=new google.maps.StreetViewService;return o.getPanoramaByLocation(t||n.getCenter,100,function(e,n){r.resolve(n===google.maps.StreetViewStatus.OK?e.location.pano:!1)}),r.promise},setPanorama:function(e,n){var t=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});t.setPano(n)}}}};var AngularFunc=function(e){if("function"!=typeof e.func||!e.deps instanceof Array)throw"Invalid obj. obj must have a `func` as function and `deps` as an array";return e.func.$inject=e.deps,e.func},ngMapModule=angular.module("ngMap",[]);for(var key in ngMap.services)ngMapModule.service(key,AngularFunc(ngMap.services[key]));for(var key in ngMap.directives)ngMapModule.directive(key,AngularFunc(ngMap.directives[key]));